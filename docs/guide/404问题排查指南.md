---
title: 404 问题排查和解决指南
date: 2024-10-27
permalink: /guide/404-troubleshooting/
article: false
---

# 404 问题排查和解决指南

本文档记录了项目中可能出现的 404 问题及其解决方案。

## 问题概述

### 典型症状

访问某些页面时返回 404 错误，例如：
```
https://zhanglkx.github.io/FrontendNotes/pages/ts-axios/01.初识 TypeScript/
```

### 根本原因

**目录链接缺少 index.md 文件**

VitePress 的路由机制：
- 访问目录路径（以 `/` 结尾）时，会查找该目录下的 `index.md` 或 `index.html`
- 如果找不到这些文件，返回 404 错误
- 即使目录下有其他 `.md` 文件，也无法自动显示

**示例说明**

```bash
# 文件结构
docs/《TypeScript 从零实现 axios》/
  └── 01.初识 TypeScript/
      ├── 01.简介.md          # ✅ 存在
      ├── 02.安装 TypeScript.md  # ✅ 存在
      └── index.md             # ❌ 缺失 (导致 404)

# 侧边栏配置
sidebar: {
  "/pages/ts-axios/": [
    {
      text: "初识 TypeScript",
      link: "/pages/ts-axios/01.初识 TypeScript/"  // 指向目录，需要 index.md
    }
  ]
}

# 访问流程
用户点击链接 → VitePress 查找 index.md → 未找到 → 返回 404
```

## 解决方案

### 方案 1：创建 index.md 文件（推荐）

为每个章节目录创建导航页面，提供更好的用户体验。

**index.md 模板**

```markdown
---
title: 章节标题
date: 2024-01-01
permalink: /pages/xxx/章节路径/
article: false
---

# 章节标题

本章节介绍...

## 学习内容

- [文章1](./01.文章1) - 文章1简介
- [文章2](./02.文章2) - 文章2简介
- [文章3](./03.文章3) - 文章3简介
```

**批量创建示例**

```bash
# 为 TypeScript 教程所有子章节创建 index.md
for dir in docs/《TypeScript 从零实现 axios》/*/; do
  if [ ! -f "$dir/index.md" ]; then
    echo "Creating index.md for $dir"
    cat > "$dir/index.md" << 'EOF'
---
title: 章节标题
date: 2024-01-01
article: false
---

# 章节标题

章节内容介绍...
EOF
  fi
done
```

### 方案 2：修改链接指向具体文件

将侧边栏链接改为指向第一个具体文件，而非目录。

**修改前**
```typescript
{
  text: "初识 TypeScript",
  link: "/pages/ts-axios/01.初识 TypeScript/"  // 指向目录
}
```

**修改后**
```typescript
{
  text: "初识 TypeScript",
  link: "/pages/ts-axios/01.初识 TypeScript/01.简介"  // 指向具体文件
}
```

**优缺点对比**

| 方案 | 优点 | 缺点 |
|------|------|------|
| 创建 index.md | ✅ 提供章节概览<br>✅ 更好的导航体验<br>✅ 符合用户预期 | ❌ 需要维护额外文件 |
| 链接到文件 | ✅ 快速修复<br>✅ 不需要额外文件 | ❌ 缺少章节概览<br>❌ 用户体验较差 |

## 已修复的问题

### TypeScript 教程 404 问题

**修复时间**: 2024-10-27

**影响范围**: 12 个子章节

**修复内容**:
1. ✅ 01.初识 TypeScript/index.md
2. ✅ 02.TypeScript 常用语法/index.md
3. ✅ 03.ts-axios 项目初始化/index.md
4. ✅ 04.ts-axios 基础功能实现/index.md
5. ✅ 05.ts-axios 异常情况处理/index.md
6. ✅ 06.ts-axios 接口扩展/index.md
7. ✅ 07.ts-axios 拦截器实现/index.md
8. ✅ 08.ts-axios 配置化实现/index.md
9. ✅ 09.ts-axios 取消功能实现/index.md
10. ✅ 10.ts-axios 更多功能实现/index.md
11. ✅ 11.ts-axios 单元测试/index.md
12. ✅ 12.ts-axios 部署与发布/index.md

**验证命令**

```bash
# 运行检查脚本
./scripts/check-missing-index.sh

# 输出：
# ✅ 所有 35 个目录都有 index.md 文件
# 🎉 没有发现潜在的 404 问题
```

## 预防措施

### 1. 使用检查脚本

项目提供了自动化检查脚本：

```bash
# 运行检查
./scripts/check-missing-index.sh
```

**建议使用场景**：
- 添加新的教程目录时
- 修改 rewrites 配置后
- 部署前的最终检查

### 2. 开发规范

**添加新目录时的检查清单**：

- [ ] 创建目录和文章文件
- [ ] 创建 index.md 导航页面
- [ ] 在 `config.mts` 中添加 rewrites 规则
- [ ] 在 sidebar 配置中添加导航项
- [ ] 在 nav 中添加入口（如需要）
- [ ] 运行 `pnpm run dev` 本地测试
- [ ] 运行检查脚本验证
- [ ] 提交并部署

### 3. rewrites 配置规范

**正确的 rewrites 配置**

```typescript
rewrites: {
  // ✅ 使用 :path* 通配符匹配目录下所有文件
  "《TypeScript 从零实现 axios》/:path*": "pages/ts-axios/:path*",
  
  // ❌ 错误：只匹配 index.md
  "《TypeScript 从零实现 axios》/index.md": "pages/ts-axios/index.md",
  
  // ❌ 错误：缺少通配符
  "《TypeScript 从零实现 axios》/": "pages/ts-axios/",
}
```

### 4. sidebar 配置规范

**两种正确的配置方式**

```typescript
// 方式 1: 链接到目录（需要有 index.md）
{
  text: "章节名称",
  link: "/pages/chapter/"  // 目录下必须有 index.md
}

// 方式 2: 链接到具体文件（推荐明确文件）
{
  text: "章节名称",
  link: "/pages/chapter/01.article"  // 直接指向 .md 文件
}
```

## 快速排查流程

遇到 404 问题时，按以下步骤排查：

### Step 1: 确认文件是否存在

```bash
# 找到原始文件路径
# 404 URL: /pages/ts-axios/01.初识 TypeScript/
# 查找对应的原始文件

# 检查 rewrites 配置
# "《TypeScript 从零实现 axios》/:path*": "pages/ts-axios/:path*"

# 推断原始路径
# docs/《TypeScript 从零实现 axios》/01.初识 TypeScript/

# 检查是否存在 index.md
ls -la "docs/《TypeScript 从零实现 axios》/01.初识 TypeScript/index.md"
```

### Step 2: 检查 rewrites 配置

```typescript
// 在 config.mts 中查找 rewrites
rewrites: {
  "《TypeScript 从零实现 axios》/:path*": "pages/ts-axios/:path*",
}

// 验证映射关系
// 原始路径: docs/《TypeScript 从零实现 axios》/01.初识 TypeScript/
// URL 路径: /pages/ts-axios/01.初识 TypeScript/
// ✅ 映射正确
```

### Step 3: 检查 sidebar 配置

```typescript
sidebar: {
  "/pages/ts-axios/": [
    {
      text: "初识 TypeScript",
      link: "/pages/ts-axios/01.初识 TypeScript/"  // 检查路径是否正确
    }
  ]
}
```

### Step 4: 本地测试

```bash
# 启动开发服务器
pnpm run dev

# 访问问题页面
open http://localhost:5173/pages/ts-axios/01.初识 TypeScript/

# 检查浏览器控制台是否有错误
```

### Step 5: 构建验证

```bash
# 构建项目
pnpm run build

# 检查构建产物
ls -la docs/.vitepress/dist/pages/ts-axios/01.初识\ TypeScript/

# 应该看到 index.html 文件
```

## 常见问题 FAQ

### Q1: 为什么有些目录没有 index.md 也不会 404？

**A**: 这些目录没有被直接链接。如果侧边栏链接指向具体文件而非目录，就不需要 index.md。

```typescript
// 不会 404（链接到具体文件）
{ text: "文章", link: "/pages/article" }

// 可能 404（链接到目录）
{ text: "章节", link: "/pages/chapter/" }
```

### Q2: index.md 的 Front Matter 应该如何配置？

**A**: 推荐配置：

```markdown
---
title: 页面标题
date: 2024-01-01
permalink: /pages/xxx/  # 固定链接（可选）
article: false          # 不作为文章显示（可选）
---
```

### Q3: 如何批量检查项目中的 404 问题？

**A**: 使用项目提供的检查脚本：

```bash
./scripts/check-missing-index.sh
```

或者手动检查：

```bash
# 查找所有目录链接
grep -r "link:.*/$" docs/.vitepress/config.mts

# 对每个链接验证是否有对应的 index.md
```

### Q4: 部署后才发现 404，如何快速修复？

**A**: 创建缺失的 index.md 并提交：

```bash
# 1. 创建 index.md
cat > "docs/path/to/directory/index.md" << 'EOF'
---
title: 临时页面
---
# 临时页面
内容待完善...
EOF

# 2. 提交并推送
git add .
git commit -m "fix: 添加缺失的 index.md"
git push

# 3. 等待 GitHub Actions 自动部署
```

### Q5: 中文路径会影响 404 问题吗？

**A**: 不会直接导致 404，但会被 URL 编码：

```
原始路径: /pages/ts-axios/01.初识 TypeScript/
URL 编码: /pages/ts-axios/01.%E5%88%9D%E8%AF%86%20TypeScript/
```

两种 URL 都可以访问，但建议在 rewrites 中使用英文路径以提升用户体验。

## 相关资源

- [VitePress 路由文档](https://vitepress.dev/guide/routing)
- [VitePress rewrites 配置](https://vitepress.dev/guide/routing#route-rewrites)
- [项目搭建指南](/guide/项目搭建指南)

---

<div style="text-align: center; margin: 2rem 0; padding: 1.5rem; background: var(--vp-c-bg-soft); border-radius: 8px;">
  <p style="margin: 0;">💡 <strong>提示</strong></p>
  <p style="margin: 0.5rem 0 0; color: var(--vp-c-text-2);">
    定期运行检查脚本，可以有效预防 404 问题
  </p>
</div>

